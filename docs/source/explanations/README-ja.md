# EarlySign 🧪

Catch the early signs, reach faster conclusions.

<img src="https://raw.githubusercontent.com/takeshi-teshima/EarlySign/refs/heads/main/docs/logo.png" width="80%"><br/>

EarlySign は、A/Bテストや統計的モニタリングにおける意思決定を加速するためのPythonライブラリです。実験が完全に終了するのを待つことなく、データが示す「早期のサイン」を統計的に正しく捉え、より速く、確信のある結論を導き出します。


## Features: Supported Methods
EarlySign は、古典的な手法から最新の研究まで、複数の逐次分析アプローチをサポートしています。実験の特性や要件に応じて、最適な手法を選択できます。
EarlySign は、これらの複雑な実験デザインを、シンプルなインターフェイスで実行するための専用ツールを提供します。

### Group Sequential Tests (群逐次検定)
計画的な中間解析で、無駄な実験を早期に打ち切る。

古典的かつ非常にパワフルな手法です。実験期間中に「中間解析」を行うタイミングをあらかじめ複数回設定（例：1週間ごと、1000ユーザーごと）し、その都度、統計的優位性または無益性（これ以上続けても差が出ないこと）を評価します。

- ユースケース:
  - 結果を毎週の定例会でレビューするなど、分析のタイミングが決まっている場合。
  - 臨床試験のように、厳格なエラーコントロールが求められる構造化された実験。
- 主な機能:
  - エラー消費関数 (Spending Functions): O'Brien-Fleming型（保守的）やPocock型（積極的）など、早期停止のしやすさを調整するさまざまな関数をサポート。
  - 有効性・無益性中止: 効果が「ある」という結論と、「これ以上続けても有意な差は出ないだろう」という結論の両方で早期停止が可能です。

### Anytime-Valid Inference with E-values (E値による随時正当推論)

**好きな時に、何回でも。リアルタイムモニタリングのための最先端アプローチ。**

E値 (Evidence-value) は、証拠の強さを表す新しい指標です。このアプローチの最大の特徴は、分析のタイミングを事前に決める必要がないことです。データが1件追加されるたびに結果を更新し、いつでも好きな時にテストを停止して、統計的な正しさを保ったまま結論を出すことができます。

- ユースケース:
    - ユーザートラフィックが多いサービスでのリアルタイムA/Bテスト。
    - 不正検知やシステム異常監視など、継続的なモニタリングが必要な場合。
    - 「次の会議までに結果が欲しい」といった、アドホックな分析要求。
- 主な機能:
    - Anytime-valid p-values: いつでも解釈可能なp値を算出します。
    - ストリーミングデータ対応: 新しいデータが到着するたびに、過去の証拠と統合してE値を更新します。

### Sequential Probability Ratio Test (SPRT) (逐次確率比検定)
**最も効率的なクラシック手法で、白黒はっきりつける。**

2つの明確な仮説（例：「CVRは3%」vs「CVRは5%」）のどちらが正しいかを判断するための、最も基本的な逐次検定です。多くの場合、固定サンプルサイズの検定や他の逐次検定に比べて、平均的により少ないサンプル数で結論に到達できます。

- ユースケース:
    - 改善効果の目標値が明確なA/Bテスト。
    - 品質管理における良品／不良品の判定。
- 主な機能:
    - シンプルな境界設定: 2つの仮説と許容エラー率（α, β）から、継続・受容・棄却の境界を自動で計算します。

### Stepped-Wedge Design (ステップドウェッジデザイン)
**全ユーザーへの展開を安全かつ段階的に行い、その効果を正しく測定する。**

新機能を全ユーザーに展開することが決まっているが、リスク管理のために一度には導入したくない、という状況は頻繁に発生します。このデザインは、ユーザーグループを複数に分け、ランダムな順序で段階的に新機能へ移行させます。

- EarlySignの役割:
    - 複雑な分析の自動化: このデザインでは、時間経過による影響（トレンド）を考慮した分析（混合効果モデルなど）が必要です。EarlySignはこれらの複雑なモデルを内部で処理し、介入の真の効果を逐次的にモニタリングします。
    - 早期異常検知: 新機能に移行したグループでKPIが悪化するなど、予期せぬ問題が発生した場合、EarlySignはそれを早期に検知し、ロールアウトを一時停止するなどの判断を支援します。

### Test and Roll (テスト＆ロール戦略)
**「最速のテスト」と「安全な展開」を一つのワークフローで実現する。**

これは、多くのWebサービスで採用されている、最も実践的なデプロイ戦略です。まず少数のユーザーでA/Bテスト（Testフェーズ）を行い、次にその勝者を全ユーザーに段階的に展開（Rollフェーズ）します。

- EarlySignの役割:
    - Testフェーズの加速: EarlySignのコアな逐次検定（E値やSPRT）を用いることで、ごく一部のトラフィック（例: 5%）で、統計的に信頼できる勝者を従来よりも遥かに速く決定します。
    - Rollフェーズの監視: 展開はそれ自体がリスクを伴います。EarlySignは、ロールアウトの各段階（10%→50%→100%）で主要なビジネス・システム指標を継続的に監視します。勝者バリアントが、テストでは見られなかった想定外の悪影響（例：サーバー負荷の急増、特定ユーザーセグメントでの著しい体験悪化など）を引き起こしていないかを保証し、安全な展開を支援します。
